async function calcularFrete() {
    const cep = document.getElementById('cep').value;
    const cepOrigem = "14408014"; // CEP da empresa

    if (!cep || cep.length !== 8 || isNaN(cep)) {
        cepError.style.display = 'block';
        frete = 0;
        atualizarTotal();
        return;
    } else {
        cepError.style.display = 'none';
    }

    const cidadeOrigem = await verificarCidade(cepOrigem);
    const cidadeDestino = await verificarCidade(cep);

    if (cidadeOrigem && cidadeDestino && cidadeOrigem === cidadeDestino) {
        frete = 0; // Frete grátis para a mesma cidade
        document.getElementById('frete').textContent = 'Gratuito'; // Exibe "Gratuito"
        atualizarTotal();
        return;
    }

    loadingSpinner.style.display = 'block'; // Mostra o spinner de carregamento

    const peso = 0.3;
    const altura = 4;
    const largura = 12;
    const comprimento = 17;

    try {
        const response = await fetch('https://api-frete-xz1n.onrender.com/calcular-frete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                cepDestino: cep,
                cepOrigem: cepOrigem,
                peso: peso,
                altura: altura,
                largura: largura,
                comprimento: comprimento,
            }),
        });

        if (!response.ok) {
            throw new Error('Erro ao calcular frete');
        }

        const data = await response.json();

        if (data && data.error && data.error.includes("mesma cidade")) {
            frete = 0; // Frete grátis para a mesma cidade
            document.getElementById('frete').textContent = 'Gratuito'; // Exibe "Gratuito"
        } else if (data && data.length > 0 && !isNaN(parseFloat(data[0].price))) {
            const precoFormatado = data[0].price.replace('R$', '').replace(',', '.').trim();
            frete = parseFloat(precoFormatado);
            document.getElementById('frete').textContent = `$${frete.toFixed(2)}`; // Exibe o valor do frete
        } else {
            frete = 0;
            alert('Não foi possível calcular o frete. Tente novamente mais tarde.');
        }
    } catch (error) {
        console.error('Erro ao calcular frete:', error);
        frete = 0;
        alert('Erro ao calcular o frete. Tente novamente mais tarde.');
    } finally {
        loadingSpinner.style.display = 'none'; // Esconde o spinner de carregamento
    }

    atualizarTotal();
}
